Model aql_cities {
  type: 'query'
  label: 'aql_cities'
  description: ''
  data_source_name: 'demodb'
  dimension id {
    label: 'Id'
    type: 'number'
    hidden: false
    definition: @sql {{ #SOURCE.id }};;
  }
  dimension name {
    label: 'Name'
    type: 'text'
    hidden: false
    definition: @sql {{ #SOURCE.name }};;
  }
  dimension country_code {
    label: 'Country Code'
    type: 'text'
    hidden: false
    definition: @sql {{ #SOURCE.country_code }};;
  }

  dimension aql_dim {
    label: 'AQL DIM',
    type: 'text'
    definition: @aql aql_cities | count(aql_cities.name);;
  }

  dimension dynamic_dimension {
    label: 'dynamic_dimension'
    type: 'text'
    hidden: false
  }

  // Parameters
  param city_param_text {
    label: 'City Param - text'
    type: 'text'

    allowed_values: [
      'Chicago',
      'New York',
      'Ho Chi Minh'
    ]
  }


  param field_selection {
    type: 'text'
    label: 'Field Selection'
    allowed_values: ['field1', 'field2', 'field3']
  }


  query: @sql
    select CASE
        WHEN {% filter(field_selection) %} 'field1' {% end %} THEN {{ #ci.country_code }}
        WHEN {% filter(field_selection) %} 'field2' {% end %} THEN {{ #ci.name }}
        WHEN {% filter(field_selection) %} 'field3' {% end %} THEN {{ #ci.count_id }}
        ELSE 'unknown'
    END as dynamic_dimension
    from {{ #cities as ci }}
  ;;

  owner: 'dat.cv+staging0@holistics.io'

  models: [
    aql_base_cities,
    cities
  ]
}
