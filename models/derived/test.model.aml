Model product_details_2 {
  type: 'query'
  label: "Product Details"
  description: ""
  owner: 'khai.to@holistics.io'
  data_source_name: 'demodb'

  models: [products_2, categories_3]

  query: @sql 
    SELECT {{ #p.id }} as product_id
      , {{ #p.name }} as product_name
      , {{ #p.price }} as product_price
      , {{ #p.created_at }} as product_created_at
      , {{ #p.merchant_id }}
      , {{ #ca.id }} as category_id
    FROM {{ #products p }} LEFT JOIN {{ #categories ca }} ON {{ #p.category_id }} = {{ #ca.id }}
  ;;

  dimension product_id {
    label: 'Product ID'
    type: 'number'
  }

  dimension product_name {
    label: 'Product Name'
    type: 'text'
  }

  dimension product_price {
    label: 'Product Price'
    type: 'number'
  }

  dimension product_created_at {
    label: 'Product Created At'
    type: 'datetime'
  }

  dimension merchant_id {
    label: 'Merchant ID'
    type: 'number'
  }

  dimension category_id {
    label: 'Category ID'
    type: 'number'
  }

}

Model order_details_test {
  type: 'query'
  label: "Order Details"
  description: ""
  owner: 'khai.to@holistics.io'
  data_source_name: 'demodb'

  models: [orders_2, order_items, users_2]

  query: @sql 
    select {{ #u.id }} as "user_id" 
      , {{ #o.id }} as order_id
      , {{ #o.created_at }} as order_created_at
      , {{ #o.delivery_attempts }}
      , {{ #o.discount }}
      , {{ #o.status }} as order_status
      , {{ #oi.product_id }}
      , {{ #oi.quantity }}
    from {{ #order_items as oi }}
      left join {{ #orders as o }} on {{ #oi.order_id }} = {{ #o.id }}
      left join {{ #users as u }} on {{ #o.user_id }} = {{ #u.id }}
  ;;

  dimension user_id {
    label: 'User ID'
    type: 'number'
  }

  dimension order_id {
    label: 'Order ID'
    type: 'number'
  }

  dimension order_created_at {
    label: 'Order Created At'
    type: 'datetime'
  }

  dimension delivery_attempts {
    label: 'Delivery Attempts'
    type: 'number'
  }

  dimension discount {
    label: 'Discount'
    type: 'number'
  }

  dimension order_status {
    label: 'Order Status'
    type: 'text'
  }

  dimension product_id {
    label: 'Product ID'
    type: 'number'
  }

  dimension quantity {
    label: 'Quantity'
    type: 'number'
  }

  measure total_quantity {
    label: 'Quantity'
    type: 'number'
    definition: @sql {{ quantity }};;
    aggregation_type: 'sum'
  }

  measure custom_measure {
    label: 'custom_measure'
    type: 'number'
    definition: @aml order_details_test.total_quantity / 3;;
  }

}